{% extends "layouts/base.html" %}
{% block content %}

<h3 class="fw-bold mb-4">All Products</h3>

<form method="GET" class="row g-3 mb-4">

    <div class="col-md-4">
        <input type="text" name="q" value="{{ q }}" placeholder="Search for products..."
               class="form-control">
    </div>

    <div class="col-md-3">
        <select name="category" class="form-select">
            <option value="">All Categories</option>
            {% for c in categories %}
                <option value="{{ c }}" {% if c == current_category %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-3">
        <select name="sort" class="form-select">
            <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Newest First</option>
            <option value="price_low" {% if sort == 'price_low' %}selected{% endif %}>Price: Low to High</option>
            <option value="price_high" {% if sort == 'price_high' %}selected{% endif %}>Price: High to Low</option>
        </select>
    </div>

    <div class="col-md-2">
        <button class="btn btn-primary w-100">Apply</button>
    </div>

</form>

<div class="row g-4">

    {% for product in products %}
    <div class="col-md-3">
        <div class="card shadow-sm rounded-4 p-2 h-100">

            {% if product.image_filename %}
                <img src="{{ url_for('static', filename='uploads/images/' ~ product.image_filename) }}"
                     class="img-fluid rounded mb-2"
                     style="height: 200px; object-fit: cover;">
            {% else %}
                <div class="bg-light rounded mb-2 d-flex align-items-center justify-content-center"
                     style="height: 200px;">
                    <span class="text-muted small">No Image</span>
                </div>
            {% endif %}

            <h6 class="fw-semibold">{{ product.name }}</h6>
            <p class="text-muted small mb-1">{{ product.category }}</p>
            <h5 class="fw-bold text-primary mb-2">â‚¹{{ product.price }}</h5>

            <a href="{{ url_for('products.product_details', product_id=product.id) }}"
               class="btn btn-primary w-100 mt-auto">View</a>
        </div>
    </div>
    {% endfor %}

</div>

{% endblock %}
