{% extends "layouts/base.html" %}
{% block content %}

<h3 class="fw-bold mb-4">Orders for Your Products</h3>

{% if orders|length == 0 %}
    <div class="alert alert-info">No customer has ordered any of your products yet.</div>
{% else %}

<table class="table table-hover align-middle shadow-sm rounded">
    <thead class="table-primary">
        <tr>
            <th>Product</th>
            <th>Customer</th>
            <th>Qty</th>
            <th>Status</th>
            <th>Update</th>
            <th>Delete</th>
        </tr>
    </thead>

    <tbody>

    {% for order in orders %}
        <tr>
            <td class="d-flex align-items-center">

                {# ðŸ”¥ FIXED IMAGE PATH ðŸ”¥ #}
                {% if order.product and order.product.image_filename %}
                    <img src="{{ url_for('static', filename='uploads/images/' ~ order.product.image_filename) }}"
                         style="width: 60px; height: 60px; object-fit: cover;"
                         class="rounded me-2">
                {% else %}
                    <div class="bg-light rounded d-flex align-items-center justify-content-center me-2"
                         style="width: 60px; height: 60px;">
                        <span class="text-muted small">No Image</span>
                    </div>
                {% endif %}

                {{ order.product.name }}
            </td>

            <td>
                {{ order.user.full_name }}<br>
                <span class="text-muted small">{{ order.user.email }}</span>
            </td>

            <td>{{ order.quantity }}</td>

            <td>
                <span class="badge 
                    {% if order.status == 'Delivered' %}bg-success
                    {% elif order.status == 'Shipped' %}bg-primary
                    {% else %}bg-warning text-dark{% endif %}">
                    {{ order.status }}
                </span>
            </td>

            <td>
                <form method="POST"
                      action="{{ url_for('orders.update_order_status', order_id=order.id) }}"
                      class="d-flex">

                    <select name="status" class="form-select form-select-sm me-2">
                        <option value="Pending" {% if order.status == 'Pending' %}selected{% endif %}>Pending</option>
                        <option value="Shipped" {% if order.status == 'Shipped' %}selected{% endif %}>Shipped</option>
                        <option value="Delivered" {% if order.status == 'Delivered' %}selected{% endif %}>Delivered</option>
                    </select>

                    <button class="btn btn-success btn-sm">Save</button>
                </form>
            </td>

            <td>
                <a href="{{ url_for('orders.delete_seller_order', order_id=order.id) }}"
                   class="btn btn-danger btn-sm"
                   onclick="return confirm('Delete this order?')">
                   Delete
                </a>
            </td>
        </tr>
    {% endfor %}

    </tbody>

</table>

{% endif %}

{% endblock %}
